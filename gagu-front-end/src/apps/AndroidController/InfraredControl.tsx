import { Button, RadioGroup, Radio, Input, Tabs, TabPane } from '@douyinfe/semi-ui'
import { useCallback, useMemo, useState } from 'react'
import { useRequest } from '../../hooks'
import { TermuxApi } from '../../api'
import toast from 'react-hot-toast'
import { SvgIcon } from '../../components/common'
import { IInfraredTransmitForm } from '../../types'

const MI_TV_MAP = {
  POWER: [
    '1018,590,600,586,600,1458,600,1464,598,588,598,1464,626,560,598,1466,596,590,602,1456,598,1466,600,10670,1024,586,598,586,602,1458,598,1464,600,584,598,1466,598,586,600,1464,626,560,620,1436,626,1440,622,10646,1050,560,626,558,628,1432,626,1438,626,558,628,1436,624,562,626,1438,624,560,626,1434,626,1438,624,10640,1046,562,626,560,622,1436,626,1436,624,564,624,1438,630,556,626,1438,624,562,626,1432,624,1440,628,10642,1046,564,626,560,626,1432,626,1438,628,558,620,1442,624,562,626,1436,626,560,628,1432,622,1442,628,10640,1048,562,626,560,622,1436,628,1438,622,562,622,1442,626,558,624,1440,622,562,626,1434,622,1440,628,10640',
    '990,620,564,622,560,1496,560,1502,562,624,562,1496,562,648,536,1506,562,622,558,1498,566,1496,562,10696,990,624,560,626,558,1500,562,1500,558,628,562,1498,564,622,560,1502,558,626,562,1496,562,1502,558,10698,992,620,558,628,558,1500,560,1502,562,622,562,1502,558,650,534,1504,558,628,562,1494,564,1498,558,10694,994,622,562,624,562,1492,566,1498,564,620,560,1502,566,620,562,1500,560,624,562,1500,556,1506,558,10702,984,624,560,624,558,1498,566,1522,540,622,562,1500,558,594,594,1502,564,646,536,1496,562,1504,560,10698,984,624,562,624,562,1520,542,1496,564,622,562,1498,566,646,534,1502,566,620,564,1494,560,1502,564,10698',
  ],
  UP: [
    '1016,590,592,1172,594,596,590,884,594,1170,596,594,594,594,590,886,590,884,594,1166,590,1474,588,12432,1020,588,588,1176,592,596,588,886,594,1172,590,600,590,596,596,878,594,882,594,1166,596,1468,592,12430,1018,588,590,1174,588,600,588,886,588,1176,594,596,592,594,590,884,594,880,592,1168,590,1472,592,12430,1014,592,594,1170,588,600,588,886,594,1170,590,600,592,596,588,886,590,884,592,1166,592,1472,594,12426,1014,592,590,1174,590,598,594,880,590,1172,590,600,594,594,592,884,588,886,590,1168,594,1470,592,12426,1018,588,594,1172,592,596,590,884,594,1170,592,596,594,594,592,882,590,884,594,1164,590,1474,590,12426',
    '1016,592,588,1174,592,596,592,914,564,1170,590,598,592,596,594,884,590,884,590,1170,590,1472,594,12428,1014,590,590,1176,594,594,592,882,592,1172,592,598,594,596,590,884,590,884,590,1170,592,1472,588,12430,1018,590,594,1172,594,594,592,882,594,1200,564,596,592,594,588,886,594,880,588,1170,594,1470,590,12460,986,592,588,1176,592,596,592,884,594,1170,588,602,594,594,588,886,588,888,594,1164,590,1472,594,12424,1018,590,594,1170,588,598,592,884,592,1174,594,624,558,600,592,882,590,884,594,1166,590,1472,596,12454,982,594,594,1170,592,594,592,884,592,1170,592,598,588,598,594,882,590,884,592,1168,590,1504,564,12454',
  ],
  DOWN: [
    '984,622,562,1202,558,598,594,914,562,1222,538,598,590,630,562,912,558,1202,564,1202,558,630,562,13048,986,586,596,1202,562,594,594,912,564,1202,562,592,596,650,534,936,538,1204,562,1204,556,632,562,13046,988,620,556,1192,574,626,558,882,592,1206,560,598,590,596,592,916,560,1200,562,1202,560,598,596,13044,988,618,568,1168,594,626,562,914,562,1204,560,632,558,626,560,914,556,1204,566,1202,562,648,542,13044,986,588,594,1204,558,654,534,882,592,1204,558,632,562,624,566,912,558,1170,596,1200,564,626,562,13014,1018,588,592,1204,562,626,560,912,562,1200,560,632,560,592,596,878,592,1204,564,1200,560,630,558,13014',
    '986,590,592,1200,566,594,592,908,564,1172,594,596,592,596,588,884,592,1202,556,1206,562,628,564,13046,984,592,594,1172,592,624,560,884,594,1226,538,598,592,594,590,886,588,1202,560,1228,540,596,590,13048,990,618,560,1176,592,596,594,910,566,1200,558,602,592,624,562,934,542,1198,560,1176,588,632,562,13044,988,590,590,1174,594,626,560,884,594,1200,564,596,588,654,540,910,562,1170,594,1200,558,628,562,13020,1014,622,562,1202,562,626,560,884,590,1204,564,610,576,598,594,880,588,1202,560,1174,590,600,590,13046,984,622,564,1172,590,628,558,938,540,1202,564,596,594,646,542,910,564,1168,590,1174,592,628,558,13046',
  ],
  LEFT: [
    '984,622,560,1204,562,626,564,910,562,1202,564,626,562,626,560,1198,560,1500,558,916,560,918,564,12458,984,620,562,1202,564,626,560,912,564,1202,566,624,562,624,566,1194,564,1498,560,916,564,914,558,12462,982,624,566,1198,560,628,560,914,564,1200,564,624,566,622,566,1194,566,1496,562,912,564,912,564,12456,984,622,560,1204,566,622,566,908,566,1200,564,624,566,620,564,1196,562,1498,564,912,566,910,562,12458,982,622,564,1202,562,624,566,908,562,1202,566,624,564,624,566,1194,562,1498,564,910,560,918,564,12456,988,616,562,1204,560,628,564,908,562,1202,562,628,562,624,566,1194,560,1500,564,910,562,916,560,12456',
    '982,622,564,1200,558,630,558,916,560,1206,558,630,564,624,562,1198,558,1502,560,914,558,918,564,12458,984,620,558,1206,560,628,566,908,562,1204,560,628,562,626,562,1198,564,1498,562,914,564,912,560,12460,984,622,564,1200,564,624,568,906,566,1200,560,628,562,626,566,1194,568,1494,566,908,562,916,562,12460,984,620,562,1204,564,622,564,910,564,1200,562,628,564,622,568,1194,562,1498,568,908,566,912,566,12454,988,618,568,1198,562,626,564,908,568,1198,566,622,568,620,568,1192,564,1498,566,910,568,910,564,12456,988,616,568,1198,568,620,568,906,564,1200,562,628,562,626,564,1194,566,1496,560,914,562,914,566,12456',
  ],
  RIGHT: [
    '986,620,566,1200,562,624,560,916,560,1202,566,624,566,620,558,1502,562,630,564,624,562,1198,562,13042,990,620,558,1206,566,622,564,910,562,1226,542,648,536,624,562,1502,564,626,564,646,540,1202,562,13042,990,618,562,1202,560,630,558,914,566,1198,562,628,562,622,564,1498,566,624,560,628,564,1202,564,13038,986,624,558,1204,562,650,540,908,560,1204,564,650,538,648,534,1502,566,626,564,622,564,1200,562,13044,988,618,560,1204,560,628,562,912,562,1202,560,630,560,624,562,1502,562,628,562,624,566,1200,562,13010,1020,618,562,1204,560,650,534,938,536,1204,562,628,564,622,564,1498,564,626,558,630,558,1202,562,13010',
    '990,620,562,1202,564,624,562,912,562,1202,562,596,590,624,564,1498,562,598,592,626,560,1202,564,13040,986,620,564,1222,536,598,592,884,590,1204,564,628,564,622,562,1468,592,652,540,624,558,1174,594,13038,988,648,538,1202,564,592,592,914,558,1204,562,630,562,622,560,1504,564,594,596,624,560,1202,562,13044,986,622,562,1222,544,646,538,914,558,1204,562,596,592,648,538,1500,560,630,558,630,562,1202,564,13042,988,618,564,1170,594,626,562,910,558,1204,558,632,562,624,562,1502,564,626,562,598,586,1204,562,13038,992,586,594,1202,562,626,558,914,562,1202,562,628,560,624,562,1500,560,630,558,630,556,1206,564,13038',
  ],
  OK: [
    '988,590,592,1172,592,628,562,910,558,1176,590,600,586,624,564,1500,566,912,562,622,566,1470,590,12452,990,590,592,1202,560,598,592,882,590,1204,562,598,586,628,560,1470,594,912,560,626,558,1506,564,12448,984,620,562,1204,560,630,558,914,560,1174,592,598,590,594,588,1502,564,914,560,624,562,1498,562,12450,990,616,566,1224,540,624,564,910,560,1174,592,596,590,594,592,1468,592,916,562,622,560,1502,560,12454,984,592,594,1200,560,628,560,912,562,1226,538,630,560,616,572,1496,560,916,562,624,560,1472,592,12444,992,590,592,1200,560,628,564,908,564,1170,590,600,592,622,558,1472,592,914,564,620,564,1498,560,12444',
    '982,624,560,1204,558,630,560,916,562,1202,564,626,560,624,560,1500,562,916,564,620,560,1502,586,12430,982,622,562,1202,562,626,566,908,562,1202,560,630,564,622,566,1494,566,912,564,620,566,1500,562,12452,990,616,562,1204,564,624,566,908,564,1200,562,630,562,622,566,1496,568,910,562,622,566,1472,594,12448,986,620,568,1196,566,622,568,906,630,1134,568,620,562,624,564,1498,566,910,564,620,566,1498,568,12448,990,616,568,1196,562,626,564,912,564,1200,564,628,568,616,566,1496,570,908,564,622,566,1498,564,12452,988,618,564,1200,568,622,562,912,568,1196,564,626,570,616,566,1494,564,914,568,618,566,1496,568,12452',
  ],
  HOME: [
    '988,618,566,1198,566,622,562,912,562,1202,562,628,562,626,566,1200,562,624,566,908,562,1204,566,13046,984,622,568,1198,568,620,568,906,564,1200,564,626,564,624,566,1200,566,620,566,908,568,1196,564,13048,990,616,568,1196,568,620,562,912,564,1200,562,628,564,622,562,1202,562,626,562,912,564,1200,562,13048,988,618,566,1198,562,626,564,910,562,1204,568,622,568,620,568,1196,564,622,566,910,566,1198,564,13048,990,616,564,1200,568,620,568,908,566,1200,570,620,568,620,566,1198,564,624,568,906,568,1196,562,13050,992,614,568,1196,564,624,562,912,564,1202,568,622,566,622,564,1200,568,620,570,904,570,1194,564,13050',
    '986,618,562,1202,562,626,566,908,560,1206,562,628,564,622,562,1202,560,626,560,938,540,1200,562,13048,990,616,562,1202,564,624,562,912,566,1198,568,622,566,620,564,1200,566,622,564,910,566,1200,566,13040,982,622,564,1202,564,622,566,908,564,1200,560,628,566,620,562,1202,566,622,560,914,562,1204,564,13044,990,616,566,1198,564,624,560,914,562,1202,562,628,564,622,568,1196,562,626,568,906,564,1200,568,13042,984,622,560,1204,566,624,564,910,564,1200,568,622,562,626,562,1202,566,622,562,912,562,1202,564,13046,984,620,566,1200,566,620,562,912,568,1198,564,626,562,624,568,1198,566,622,564,910,566,1198,562,13046',
  ],
  BACK: [
    '982,622,562,1202,562,624,560,914,560,1204,562,628,562,628,558,912,566,1496,564,1198,562,914,566,12456,984,622,568,1196,566,620,566,908,562,1202,566,624,564,624,566,906,568,1494,562,1200,566,912,560,12464,986,618,566,1198,568,620,564,910,566,1198,564,624,568,622,560,910,566,1496,564,1198,568,910,568,12454,986,620,566,1198,568,620,564,910,564,1200,568,622,568,622,564,906,618,1442,562,1202,564,914,562,12460,984,620,562,1202,564,624,568,906,564,1200,562,628,560,626,568,904,568,1492,564,1200,562,914,564,12458,990,616,564,1200,562,626,568,908,562,1202,562,628,562,624,564,934,540,1496,564,1198,568,910,568,12458',
    '980,624,564,1200,564,624,562,912,560,1206,562,628,562,626,562,910,562,1496,562,1202,558,918,558,12464,986,618,564,1200,566,620,560,914,560,1204,566,624,562,626,566,906,564,1494,562,1200,564,912,566,12458,988,618,560,1206,566,622,566,908,566,1200,564,624,564,622,562,912,560,1498,562,1202,566,910,562,12458,988,616,564,1200,564,622,566,908,562,1202,564,626,564,624,566,904,568,1492,566,1196,566,912,564,12458,988,618,566,1198,564,624,566,908,566,1198,560,628,562,626,564,908,564,1496,560,1202,566,910,564,12456,990,614,568,1196,568,620,566,908,564,1200,566,624,562,624,564,908,562,1498,562,1200,566,912,568,12456',
  ],
  MENU: [
    '984,620,562,1204,564,624,566,908,564,1200,564,626,566,622,562,916,562,624,558,1202,564,1200,562,13050,986,620,566,1198,560,626,560,914,562,1202,566,624,560,626,564,912,566,620,566,1194,564,1200,562,13050,982,622,566,1200,564,624,560,914,566,1200,564,624,562,626,562,916,566,620,564,1198,566,1198,562,13048,990,616,564,1200,564,624,562,912,568,1198,562,628,566,622,564,914,562,624,566,1196,566,1198,566,13044,992,614,564,1202,562,624,566,908,566,1200,566,624,564,624,560,916,566,620,562,1200,568,1200,558,13048,986,620,560,1204,568,620,564,910,568,1198,564,626,564,624,562,916,566,620,564,1198,568,1198,564,13048',
    '988,618,562,1202,562,626,560,914,560,1206,562,626,566,622,562,914,560,628,562,1200,566,1198,562,13048,988,618,566,1198,564,624,622,852,560,1204,560,630,562,626,562,916,560,626,562,1202,560,1204,562,13050,988,618,566,1198,564,624,564,912,566,1198,562,628,562,626,566,910,562,626,564,1198,560,1204,566,13046,988,618,564,1202,560,628,564,910,562,1202,560,630,564,622,568,910,566,620,562,1202,566,1198,564,13046,1014,592,562,1202,564,624,562,914,566,1198,564,624,566,622,566,912,566,620,564,1198,566,1200,562,13048,986,618,562,1204,566,620,562,912,562,1202,564,626,564,622,562,914,560,626,562,1200,564,1198,566,13048',
  ],
  VOLUME_UP: [
    '986,618,562,1204,562,626,564,910,564,1200,564,624,564,622,566,1494,564,1200,562,626,562,628,562,13048,982,622,564,1202,562,626,566,908,560,1202,568,622,564,620,568,1494,566,1198,564,624,568,622,566,13042,992,612,568,1198,562,626,564,910,570,1196,562,626,564,622,566,1494,566,1196,568,622,564,626,562,13046,986,620,562,1202,568,620,568,906,566,1198,568,622,568,616,564,1496,562,1202,562,628,566,622,568,13040,984,620,564,1200,570,618,568,906,566,1198,562,628,568,616,568,1492,564,1172,594,624,568,622,562,13046,992,614,568,1196,568,618,564,910,564,1200,566,624,564,620,568,1492,568,1196,562,628,564,626,566,13046',
    '986,620,562,1202,566,622,568,908,566,1198,564,626,564,622,560,1498,562,1202,560,628,564,624,562,13046,988,618,564,1200,562,626,566,908,566,1198,566,624,566,620,566,1494,560,1204,564,626,566,622,568,13042,984,620,568,1196,562,624,566,910,566,1198,568,622,568,618,564,1496,566,1198,568,622,562,628,566,13044,990,614,562,1202,566,622,564,910,562,1202,568,622,566,620,564,1496,564,1200,568,622,564,624,566,13042,986,620,568,1196,562,626,566,908,566,1198,564,626,562,622,562,1498,568,1196,568,622,568,622,562,13044,988,618,566,1196,564,622,566,910,562,1202,566,624,568,616,562,1498,562,1202,564,626,568,622,566,13044',
  ],
  VOLUME_DOWN: [
    '988,616,566,1198,566,622,560,914,564,1200,566,624,564,618,566,1494,560,1502,564,624,562,916,562,12460,986,620,564,1200,564,624,562,912,562,1204,564,626,566,620,564,1494,566,1496,566,622,566,910,562,12460,982,622,564,1200,564,626,560,912,562,1202,560,630,562,622,560,1498,566,1496,564,624,564,912,564,12456,990,616,564,1198,568,620,564,910,564,1200,564,626,566,618,566,1492,564,1498,566,622,566,910,568,12456,990,614,568,1196,566,624,562,910,568,1198,566,624,564,620,566,1492,566,1496,562,624,562,914,562,12456,992,614,560,1202,564,624,566,908,562,1202,564,626,566,618,566,1492,564,1498,568,620,566,910,568,12456',
    '982,622,564,1202,566,622,562,912,566,1198,562,626,560,624,560,1498,560,1502,566,620,562,914,564,12458,986,618,560,1204,566,622,564,910,562,1204,566,624,566,618,562,1496,566,1496,566,622,566,912,560,12462,988,618,566,1198,566,622,562,912,560,1206,562,626,564,622,564,1494,564,1500,562,624,568,910,562,12460,984,622,562,1202,564,624,564,910,564,1200,562,626,566,618,566,1492,564,1500,564,624,564,912,560,12462,986,620,562,1202,562,626,564,910,564,1202,566,622,566,620,562,1496,564,1498,566,622,562,914,566,12456,986,620,562,1202,566,620,564,910,564,1200,560,630,562,622,564,1494,560,1504,566,622,564,914,560,12456',
  ],
}

export default function InfraredControl() {

  const [form, setForm] = useState<IInfraredTransmitForm>({
    frequency: 0,
    pattern: '',
  })

  const { request: queryInfraredFrequencies, loading, response } = useRequest(TermuxApi.queryInfraredFrequencies)
  const { request: createInfraredTransmit, loading: creating } = useRequest(TermuxApi.createInfraredTransmit)

  const frequencyList = useMemo(() => response?.data || [], [response])

  const handleQueryInfraredFrequencies = useCallback(async () => {
    await queryInfraredFrequencies()
  }, [queryInfraredFrequencies])

  const handleCreateInfraredTransmit = useCallback(async (pattern?: string) => {
    const { success } = await createInfraredTransmit({
      ...form,
      pattern: pattern || form.pattern,
    })
    if (success) {
      toast.success('OK')
    }
  }, [createInfraredTransmit, form])

  return (
    <>
      <div className="relative h-[520px] overflow-y-auto">
        <Button
          icon={<SvgIcon.Refresh />}
          className="absolute top-0 right-0"
          loading={loading}
          onClick={handleQueryInfraredFrequencies}
        />
        <div className="mt-2">
          <RadioGroup
            value={form.frequency}
            onChange={(e) => setForm({ ...form, frequency: e.target.value })}
          >
            {frequencyList.map(({ min, max }, index) => (
              <Radio
                key={index}
                value={min}
                children={`${min}Hz`}
              />
            ))}
          </RadioGroup>
        </div>

        <Tabs
          lazyRender
          type="line"
          size="small"
          className={`mt-4 ${form.frequency ? undefined : 'hidden'}`}
        >
          <TabPane tab="Specified" itemKey="specified">
            <div className="mt-2 flex items-center">
              <Input
                placeholder="Infrared pattern"
                value={form.pattern}
                onChange={(pattern) => setForm({ ...form, pattern })}
              />
              <Button
                className="ml-2 w-16"
                icon={<SvgIcon.RemoteControl />}
                loading={creating}
                onClick={() => handleCreateInfraredTransmit()}
              />
            </div>
          </TabPane>
          <TabPane tab="MI TV" itemKey="mi_tv">
            <table className="mx-auto">
              <tr>
                <td></td>
                <td className="py-4">
                  <Button
                    size="large"
                    className="m-1"
                    disabled={creating}
                    icon={<SvgIcon.Power />}
                    onClick={() => handleCreateInfraredTransmit(MI_TV_MAP.POWER[0])}
                  />
                </td>
              </tr>
              <tr>
                <td></td>
                <td>
                  <Button
                    size="large"
                    className="m-1"
                    disabled={creating}
                    icon={<SvgIcon.ArrowUp />}
                    onClick={() => handleCreateInfraredTransmit(MI_TV_MAP.UP[0])}
                  />
                </td>
              </tr>
              <tr>
                <td>
                  <Button
                    size="large"
                    className="m-1"
                    disabled={creating}
                    icon={<SvgIcon.ArrowLeft />}
                    onClick={() => handleCreateInfraredTransmit(MI_TV_MAP.LEFT[0])}
                  />
                </td>
                <td>
                  <Button
                    size="large"
                    className="m-1"
                    disabled={creating}
                    icon={<SvgIcon.Check />}
                    onClick={() => handleCreateInfraredTransmit(MI_TV_MAP.OK[0])}
                  />
                </td>
                <td>
                  <Button
                    size="large"
                    className="m-1"
                    disabled={creating}
                    icon={<SvgIcon.ArrowRight />}
                    onClick={() => handleCreateInfraredTransmit(MI_TV_MAP.RIGHT[0])}
                  />
                </td>
              </tr>
              <tr>
                <td></td>
                <td>
                  <Button
                    size="large"
                    className="m-1"
                    disabled={creating}
                    icon={<SvgIcon.ArrowDown />}
                    onClick={() => handleCreateInfraredTransmit(MI_TV_MAP.DOWN[0])}
                  /> 
                </td>
              </tr>
              <tr>
                <td>
                  <Button
                    size="large"
                    className="m-1"
                    disabled={creating}
                    icon={<SvgIcon.Home />}
                    onClick={() => handleCreateInfraredTransmit(MI_TV_MAP.HOME[0])}
                  />
                </td>
                <td className="py-4">
                  <Button
                    size="large"
                    className="m-1"
                    disabled={creating}
                    icon={<SvgIcon.ChevronLeft />}
                    onClick={() => handleCreateInfraredTransmit(MI_TV_MAP.BACK[0])}
                  />
                </td>
                <td>
                  <Button
                    size="large"
                    className="m-1"
                    disabled={creating}
                    icon={<SvgIcon.Menu />}
                    onClick={() => handleCreateInfraredTransmit(MI_TV_MAP.MENU[0])}
                  />
                </td>
              </tr>
              <tr>
                <td></td>
                <td>
                  <Button
                    size="large"
                    className="m-1"
                    disabled={creating}
                    icon={<SvgIcon.Add />}
                    onClick={() => handleCreateInfraredTransmit(MI_TV_MAP.VOLUME_UP[0])}
                  />
                </td>
              </tr>
              <tr>
                <td></td>
                <td>
                  <Button
                    size="large"
                    className="m-1"
                    disabled={creating}
                    icon={<SvgIcon.Subtract />}
                    onClick={() => handleCreateInfraredTransmit(MI_TV_MAP.VOLUME_DOWN[0])}
                  />
                </td>
              </tr>
            </table>
          </TabPane>
        </Tabs>

      </div>
    </>
  )
}
